configurations {
  integrationTestCompile.extendsFrom testCompile
  integrationTestRuntime.extendsFrom integrationTestCompile, testRuntime
}

sourceSets {
  integrationTest {
    compileClasspath = sourceSets.main.output + configurations.integrationTestCompile
    runtimeClasspath = output + compileClasspath + configurations.integrationTestRuntime
  }
}

task integrationTest(type: Test, dependsOn: install) {
  testClassesDir = sourceSets.integrationTest.output.classesDir
  classpath = sourceSets.integrationTest.runtimeClasspath
  mustRunAfter test

  systemProperty "localRepo.location", "${buildDir.absolutePath}/localRepo"
}

check.dependsOn integrationTest
